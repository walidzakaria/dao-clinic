(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32ef8dd9"],{2655:function(e,t,n){"use strict";n("efa5")},"51ee":function(e,t,n){e.exports=n.p+"static/img/user-avatar.2072cc79.webp"},"74eb":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[n("div",{staticClass:"card-header text-dark chat-header",on:{click:function(t){return e.toggleChat()}}},[e._v(" "+e._s(e.chatHeader||"unknown user")+" "),!e.open&&e.unreadNo>0?n("span",{staticClass:"unread"},[e._v(e._s(e.unreadMsg))]):e._e()]),n("div",{staticClass:"collapse",class:{show:e.open}},[n("div",{staticClass:"card-body"},[n("div",{ref:"chat-box",staticClass:"panel-body msg_container_base dialog-container",class:{"hidden-chat-box":!e.open}},e._l(e.chat,(function(t,s){return n("div",{key:s},[t.is_client?n("div",[n("div",{staticClass:"row msg_container base_receive"},[e._m(1,!0),n("div",{staticClass:"text-container"},[n("div",{staticClass:"messages msg_receive"},[n("p",[e._v(e._s(t.message))]),n("time",{attrs:{datetime:"2009-11-13T20:00"}},[e._v(" "+e._s(t.user||t.user_info)+" • "+e._s(e.calcTime(t.time))+" ")])])])])]):n("div",[n("div",{staticClass:"row msg_container base_sent"},[n("div",{staticClass:"text-container"},[n("div",{staticClass:"messages msg_sent"},[n("p",[e._v(e._s(t.message))]),n("time",{attrs:{datetime:"2009-11-13T20:00"}},[e._v(" Me • "+e._s(e.calcTime(t.time))+" ")])])]),e._m(0,!0)])])])})),0),n("div",{staticClass:"panel-footer"},[n("div",{staticClass:"input-group btn-input",class:{"hidden-chat-box":!e.open}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.userMessage,expression:"userMessage"}],ref:"chat-input",staticClass:"form-control input-sm chat_input",attrs:{type:"text",placeholder:"Write your message here...",autocomplete:"off"},domProps:{value:e.userMessage},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage()},input:function(t){t.target.composing||(e.userMessage=t.target.value)}}}),n("span",{staticClass:"input-group-btn"},[n("button",{staticClass:"btn btn-dark btn-sm btn-chat",on:{click:function(t){return e.sendMessage()}}},[e._v("Send")])])])])])])])},a=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"col-2 avatar"},[s("img",{staticClass:" img-responsive ",attrs:{src:n("e480")}})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"col-2 avatar"},[s("img",{staticClass:" img-responsive ",attrs:{src:n("51ee")}})])}],c=(n("99af"),n("d3b7"),n("25f0"),n("5530")),o=(n("96cf"),n("1da1")),r=n("2f62");function i(e){var t=e<10?"0".concat(e.toString()):e.toString();return t}var u={name:"ChatInstance",props:["room"],data:function(){return{open:!1,connection:null,chat:[],userMessage:null,username:"",userId:0,clientId:this.$store.state.chat.clientId,unreadNo:0,chatHeader:null}},computed:{unreadMsg:function(){var e=this.open?0:this.unreadNo;return e}},created:function(){},mounted:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$nextTick((function(){e.username=e.$store.state.user.userInfo.username,e.userId=e.$store.state.user.userInfo.id,e.clientId=e.$store.state.chat.clientId,e.chat=[],e.connectChat()}));case 1:case"end":return t.stop()}}),t)})))()},methods:Object(c["a"])(Object(c["a"])({},Object(r["b"])("chat",["getCSConversation"])),{},{getWebsocketLink:function(){console.log(this.room);var e="https:"===window.location.protocol?"wss":"ws",t=window.location.host;"127.0.0.1:8080"===t||"127.0.0.1:8000"===t?t="127.0.0.1:8000":t+=":8001";var n="".concat(e,"://").concat(t,"/ws/chat/").concat(this.room,"/admin/");return console.log(n),n},toggleChat:function(){this.open=!this.open,this.unreadNo=0,this.scrollChat()},connectChat:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.unreadNo=0,"0000"!==e.clientId){t.next=4;break}return t.next=4,e.$store.dispatch("chat/getClientId").then(e.clientId=e.$store.state.chat.clientId);case 4:if(console.log(e.chat.length),0!==e.chat.length){t.next=8;break}return t.next=8,e.getCSConversation(e.room).then((function(t){e.chat=t,console.log("current chat: ",e.chat),e.chatHeader="".concat(e.chat[e.chat.length-1].user_info," • ").concat(e.chat[e.chat.length-1].username)}));case 8:e.applyConnection();case 9:case"end":return t.stop()}}),t)})))()},sendMessage:function(){if(this.userMessage){console.log(this.userMessage);var e={message:this.userMessage,user:this.username,user_id:this.userId,is_client:!1};this.connection.send(JSON.stringify(e)),this.userMessage=null}},applyConnection:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.connection){t.next=7;break}return t.next=3,e.getCSConversation(e.room).then((function(t){e.chat=t,console.log("current chat: ",e.chat)}));case 3:e.connection=new WebSocket(e.getWebsocketLink()),e.connection.onclose=function(t){setTimeout((function(){console.log("connecting..."),e.connection.reconnet(t)}),1e3)},e.connection.onopen=function(e){console.log(e)},e.connection.onmessage=function(t){var n=JSON.parse(t.data);console.log("chat message data: ",n);var s={message:n.message,room:e.clientId,time:n.time,user:n.user,is_client:n.is_client,user_info:n.user_info};e.chat.push(s),s.is_client&&(e.chatHeader="".concat(e.chat[e.chat.length-1].user_info," • ").concat(e.chat[e.chat.length-1].user)),e.unreadNo+=1,e.scrollChat()};case 7:case"end":return t.stop()}}),t)})))()},calcTime:function(e){var t=new Date(e),n=new Date,s=Math.round((n-t)/1e3,0),a="";if(s<30)a="few sec.";else if(s<60)a="".concat(s," sec");else if(s<3600)a="".concat(Math.floor(s/60)," min");else if(s<86400)a="".concat(Math.floor(s/60/60)," hrs");else{var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=i(t.getDate()),r=i(t.getHours()),u=i(t.getMinutes());a="".concat(o).concat(c[t.getMonth()]," ").concat(r,":").concat(u)}return a},scrollChat:function(){var e=this;this.$nextTick((function(){var t=e.$refs["chat-box"];t&&t.scroll(0,t.scrollHeight)}))}}),watch:{open:function(){var e=this;this.$nextTick((function(){e.scrollChat()}))}}},l=u,h=(n("2655"),n("2877")),d=Object(h["a"])(l,s,a,!1,null,"5622620e",null);t["default"]=d.exports},e480:function(e,t,n){e.exports=n.p+"static/img/employee-avatar.1a220e10.webp"},efa5:function(e,t,n){}}]);
//# sourceMappingURL=chunk-32ef8dd9.c2c1263e.js.map